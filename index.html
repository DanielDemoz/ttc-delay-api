<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTC Delay Prediction & Route Optimization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #d52b1e; margin: 0; }
        .header p { color: #666; margin: 10px 0; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #eee; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; }
        .tab.active { border-bottom: 2px solid #d52b1e; color: #d52b1e; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group select, .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { background: #d52b1e; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #b8241a; }
        .result { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 4px; }
        .map-container { height: 400px; margin-top: 20px; border: 1px solid #ddd; border-radius: 4px; }
        .prediction-high { color: #d52b1e; font-weight: bold; }
        .prediction-low { color: #28a745; font-weight: bold; }
        .route-option { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .route-option.best { border-color: #28a745; background: #f8fff8; }
        .demo-notice { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöá TTC Delay Prediction & Route Optimization</h1>
            <p>Predict delays and find the best routes using machine learning</p>
        </div>
        
        <div class="demo-notice">
            <strong>üì± Demo Mode:</strong> This is a static demonstration. For full functionality with real-time predictions, 
            run the FastAPI server locally using: <code>py -m uvicorn main:app --reload</code>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('predict')">Delay Prediction</button>
            <button class="tab" onclick="showTab('route')">Route Optimization</button>
            <button class="tab" onclick="showTab('map')">Station Map</button>
        </div>
        
        <div id="predict" class="tab-content active">
            <h3>Predict Delay Probability</h3>
            <form id="predictForm">
                <div class="form-group">
                    <label>Line:</label>
                    <select id="line" required>
                        <option value="">Select Line</option>
                        <option value="YU">Yonge-University</option>
                        <option value="BD">Bloor-Danforth</option>
                        <option value="SRT">Scarborough RT</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Station:</label>
                    <select id="station" required>
                        <option value="">Select Station</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Delay Code:</label>
                    <select id="code" required>
                        <option value="">Select Code</option>
                        <option value="MUIS">Mechanical Issue</option>
                        <option value="SEC">Security</option>
                        <option value="SIG">Signal Problem</option>
                        <option value="PAS">Passenger Issue</option>
                        <option value="TRA">Track Problem</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Day of Week:</label>
                    <select id="dayOfWeek" required>
                        <option value="0">Monday</option>
                        <option value="1">Tuesday</option>
                        <option value="2">Wednesday</option>
                        <option value="3">Thursday</option>
                        <option value="4">Friday</option>
                        <option value="5">Saturday</option>
                        <option value="6">Sunday</option>
                    </select>
                </div>
                <button type="submit" class="btn">Predict Delay</button>
            </form>
            <div id="predictResult" class="result" style="display: none;"></div>
        </div>
        
        <div id="route" class="tab-content">
            <h3>Route Optimization</h3>
            <form id="routeForm">
                <div class="form-group">
                    <label>Start Station:</label>
                    <select id="startStation" required>
                        <option value="">Select Start Station</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>End Station:</label>
                    <select id="endStation" required>
                        <option value="">Select End Station</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Day of Week:</label>
                    <select id="routeDayOfWeek" required>
                        <option value="0">Monday</option>
                        <option value="1">Tuesday</option>
                        <option value="2">Wednesday</option>
                        <option value="3">Thursday</option>
                        <option value="4">Friday</option>
                        <option value="5">Saturday</option>
                        <option value="6">Sunday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Time Preference:</label>
                    <select id="timePreference">
                        <option value="any">Any Time</option>
                        <option value="rush_hour">Rush Hour (7-9 AM, 5-7 PM)</option>
                        <option value="off_peak">Off Peak</option>
                    </select>
                </div>
                <button type="submit" class="btn">Find Best Route</button>
            </form>
            <div id="routeResult" class="result" style="display: none;"></div>
        </div>
        
        <div id="map" class="tab-content">
            <h3>Station Map with Delay Predictions</h3>
            <div id="map" class="map-container"></div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map;
        let stationMarkers = {};
        
        // TTC Stations data
        const TTC_STATIONS = {
            "UNION STATION": {"lat": 43.6452, "lng": -79.3806, "line": "YU"},
            "BLOOR-YONGE": {"lat": 43.6706, "lng": -79.3856, "line": "YU"},
            "ST GEORGE": {"lat": 43.6684, "lng": -79.3997, "line": "YU"},
            "SPADINA": {"lat": 43.6674, "lng": -79.4047, "line": "YU"},
            "BAY": {"lat": 43.6706, "lng": -79.3856, "line": "YU"},
            "SHEPPARD-YONGE": {"lat": 43.7615, "lng": -79.4110, "line": "YU"},
            "FINCH": {"lat": 43.7805, "lng": -79.4147, "line": "YU"},
            "DOWNSVIEW": {"lat": 43.7225, "lng": -79.4778, "line": "YU"},
            "KIPLING": {"lat": 43.6372, "lng": -79.5356, "line": "BD"},
            "KENNEDY": {"lat": 43.7322, "lng": -79.2628, "line": "BD"},
            "DON MILLS": {"lat": 43.7615, "lng": -79.3328, "line": "BD"},
            "SCARBOROUGH CENTRE": {"lat": 43.7731, "lng": -79.2578, "line": "SRT"}
        };
        
        // Mock station predictions for demo
        const mockStationPredictions = [
            {"name": "UNION STATION", "line": "YU", "lat": 43.6452, "lng": -79.3806, "delay_probability": 0.25},
            {"name": "BLOOR-YONGE", "line": "YU", "lat": 43.6706, "lng": -79.3856, "delay_probability": 0.18},
            {"name": "ST GEORGE", "line": "YU", "lat": 43.6684, "lng": -79.3997, "delay_probability": 0.22},
            {"name": "SPADINA", "line": "YU", "lat": 43.6674, "lng": -79.4047, "delay_probability": 0.15},
            {"name": "BAY", "line": "YU", "lat": 43.6706, "lng": -79.3856, "delay_probability": 0.12},
            {"name": "SHEPPARD-YONGE", "line": "YU", "lat": 43.7615, "lng": -79.4110, "delay_probability": 0.08},
            {"name": "FINCH", "line": "YU", "lat": 43.7805, "lng": -79.4147, "delay_probability": 0.06},
            {"name": "DOWNSVIEW", "line": "YU", "lat": 43.7225, "lng": -79.4778, "delay_probability": 0.10},
            {"name": "KIPLING", "line": "BD", "lat": 43.6372, "lng": -79.5356, "delay_probability": 0.14},
            {"name": "KENNEDY", "line": "BD", "lat": 43.7322, "lng": -79.2628, "delay_probability": 0.20},
            {"name": "DON MILLS", "line": "BD", "lat": 43.7615, "lng": -79.3328, "delay_probability": 0.16},
            {"name": "SCARBOROUGH CENTRE", "line": "SRT", "lat": 43.7731, "lng": -79.2578, "delay_probability": 0.13}
        ];
        
        // Initialize map
        function initMap() {
            map = L.map('map').setView([43.6532, -79.3832], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            loadStationPredictions();
        }
        
        // Load station predictions and display on map
        function loadStationPredictions() {
            mockStationPredictions.forEach(station => {
                const color = station.delay_probability > 0.3 ? 'red' : 
                            station.delay_probability > 0.1 ? 'orange' : 'green';
                
                const marker = L.circleMarker([station.lat, station.lng], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.7,
                    radius: 8
                }).addTo(map);
                
                marker.bindPopup(`
                    <b>${station.name}</b><br>
                    Line: ${station.line}<br>
                    Delay Probability: ${(station.delay_probability * 100).toFixed(1)}%
                `);
                
                stationMarkers[station.name] = marker;
            });
        }
        
        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'map' && !map) {
                setTimeout(initMap, 100);
            }
        }
        
        // Populate station dropdowns
        function populateStations() {
            const stations = Object.keys(TTC_STATIONS);
            const stationSelects = ['station', 'startStation', 'endStation'];
            
            stationSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Select Station</option>';
                stations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = station;
                    select.appendChild(option);
                });
            });
        }
        
        // Update station dropdown based on line selection
        document.getElementById('line').addEventListener('change', function() {
            const line = this.value;
            const stationSelect = document.getElementById('station');
            stationSelect.innerHTML = '<option value="">Select Station</option>';
            
            Object.entries(TTC_STATIONS).forEach(([name, info]) => {
                if (line === '' || info.line === line) {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    stationSelect.appendChild(option);
                }
            });
        });
        
        // Handle prediction form
        document.getElementById('predictForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Mock prediction for demo
            const mockResponse = {
                "prediction": Math.random() > 0.7 ? 1 : 0,
                "probability": Math.random() * 0.4 + 0.1,
                "input": {
                    "Line": document.getElementById('line').value,
                    "Station": document.getElementById('station').value,
                    "Code": document.getElementById('code').value,
                    "DayOfWeek": parseInt(document.getElementById('dayOfWeek').value)
                }
            };
            
            displayPredictionResult(mockResponse);
        });
        
        // Handle route form
        document.getElementById('routeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Mock route optimization for demo
            const mockResponse = {
                "routes": [
                    {
                        "stations": ["UNION STATION", "BLOOR-YONGE"],
                        "total_delay_risk": 0.15,
                        "estimated_time": 8
                    },
                    {
                        "stations": ["UNION STATION", "ST GEORGE", "BLOOR-YONGE"],
                        "total_delay_risk": 0.22,
                        "estimated_time": 12
                    }
                ]
            };
            
            displayRouteResult(mockResponse);
        });
        
        // Display prediction result
        function displayPredictionResult(result) {
            const resultDiv = document.getElementById('predictResult');
            const prediction = result.prediction;
            const probability = result.probability || 0;
            
            resultDiv.innerHTML = `
                <h4>Prediction Result (Demo)</h4>
                <p><strong>Station:</strong> ${result.input.Station}</p>
                <p><strong>Line:</strong> ${result.input.Line}</p>
                <p><strong>Delay Code:</strong> ${result.input.Code}</p>
                <p><strong>Day:</strong> ${getDayName(result.input.DayOfWeek)}</p>
                <p><strong>Prediction:</strong> 
                    <span class="${prediction === 1 ? 'prediction-high' : 'prediction-low'}">
                        ${prediction === 1 ? 'HIGH DELAY RISK' : 'LOW DELAY RISK'}
                    </span>
                </p>
                <p><strong>Probability:</strong> ${(probability * 100).toFixed(1)}%</p>
                <p><em>Note: This is a demo result. For real predictions, run the FastAPI server locally.</em></p>
            `;
            resultDiv.style.display = 'block';
        }
        
        // Display route result
        function displayRouteResult(result) {
            const resultDiv = document.getElementById('routeResult');
            let html = `<h4>Route Options (Demo)</h4>`;
            
            result.routes.forEach((route, index) => {
                const isBest = index === 0;
                html += `
                    <div class="route-option ${isBest ? 'best' : ''}">
                        <h5>${isBest ? 'üèÜ Best Route' : `Route ${index + 1}`}</h5>
                        <p><strong>Total Delay Risk:</strong> ${(route.total_delay_risk * 100).toFixed(1)}%</p>
                        <p><strong>Stations:</strong> ${route.stations.join(' ‚Üí ')}</p>
                        <p><strong>Estimated Travel Time:</strong> ${route.estimated_time} minutes</p>
                    </div>
                `;
            });
            
            html += `<p><em>Note: These are demo results. For real route optimization, run the FastAPI server locally.</em></p>`;
            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }
        
        // Helper function to get day name
        function getDayName(dayOfWeek) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            return days[dayOfWeek];
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            populateStations();
        });
    </script>
</body>
</html>
